CONFIG
├── train
│   └── seed: 2222                                                              
│       name: null                                                              
│       interval: step                                                          
│       monitor: val/accuracy                                                   
│       mode: max                                                               
│       ema: 0.0                                                                
│       test: false                                                             
│       debug: false                                                            
│       ignore_warnings: false                                                  
│       state:                                                                  
│         mode: null                                                            
│         n_context: 0                                                          
│         n_context_eval: 0                                                     
│       ckpt: null                                                              
│       disable_dataset: false                                                  
│       validate_at_start: false                                                
│       pretrained_model_path: null                                             
│       pretrained_model_strict_load: true                                      
│       pretrained_model_state_hook:                                            
│         _name_: null                                                          
│       post_init_hook:                                                         
│         _name_: null                                                          
│       layer_decay:                                                            
│         _name_: null                                                          
│         decay: 0.7                                                            
│                                                                               
├── tolerance
│   └── logdir: ./resume                                                        
│       id: null                                                                
│                                                                               
├── wandb
│   └── project: TNLM                                                           
│       group: ''                                                               
│       job_type: training                                                      
│       mode: online                                                            
│       save_dir: .                                                             
│       id: null                                                                
│                                                                               
├── trainer
│   └── accelerator: gpu                                                        
│       strategy: null                                                          
│       devices: 1                                                              
│       accumulate_grad_batches: 1                                              
│       max_epochs: 200                                                         
│       gradient_clip_val: null                                                 
│       log_every_n_steps: 10                                                   
│       limit_train_batches: 1.0                                                
│       limit_val_batches: 1.0                                                  
│       enable_model_summary: false                                             
│       track_grad_norm: -1                                                     
│                                                                               
├── loader
│   └── batch_size: 50                                                          
│       num_workers: 4                                                          
│       pin_memory: true                                                        
│       drop_last: true                                                         
│                                                                               
├── dataset
│   └── _name_: cifar                                                           
│       permute: null                                                           
│       grayscale: false                                                        
│       tokenize: false                                                         
│       augment: false                                                          
│       cutout: false                                                           
│       random_erasing: false                                                   
│       val_split: 0.1                                                          
│       seed: 42                                                                
│                                                                               
├── task
│   └── _name_: base                                                            
│       loss: cross_entropy                                                     
│       metrics:                                                                
│       - accuracy                                                              
│       torchmetrics: null                                                      
│                                                                               
├── optimizer
│   └── _name_: adamw                                                           
│       lr: 0.01                                                                
│       weight_decay: 0.05                                                      
│       betas:                                                                  
│       - 0.9                                                                   
│       - 0.999                                                                 
│                                                                               
├── scheduler
│   └── _name_: cosine_warmup                                                   
│       num_warmup_steps: 900                                                   
│       num_training_steps: 180000                                              
│                                                                               
├── encoder
│   └── linear                                                                  
├── decoder
│   └── _name_: sequence                                                        
│       mode: pool                                                              
│                                                                               
├── model
│   └── layer:                                                                  
│         _name_: s4                                                            
│         d_state: 64                                                           
│         channels: 1                                                           
│         bidirectional: true                                                   
│         gate: null                                                            
│         gate_act: id                                                          
│         bottleneck: null                                                      
│         activation: gelu                                                      
│         mult_act: null                                                        
│         final_act: glu                                                        
│         postact: null                                                         
│         initializer: null                                                     
│         weight_norm: false                                                    
│         tie_dropout: true                                                     
│         mode: nplr                                                            
│         init: legs                                                            
│         measure: null                                                         
│         rank: 1                                                               
│         dt_min: 0.001                                                         
│         dt_max: 0.1                                                           
│         dt_transform: softplus                                                
│         lr:                                                                   
│           dt: 0.001                                                           
│           A: 0.001                                                            
│           B: 0.001                                                            
│         wd: 0.0                                                               
│         n_ssm: 2                                                              
│         deterministic: false                                                  
│         l_max: null                                                           
│         verbose: true                                                         
│       _name_: model                                                           
│       prenorm: false                                                          
│       transposed: false                                                       
│       n_layers: 6                                                             
│       d_model: 512                                                            
│       bidirectional: false                                                    
│       residual: R                                                             
│       pool:                                                                   
│         _name_: pool                                                          
│         stride: 1                                                             
│         expand: null                                                          
│       norm: layer                                                             
│       dropout: 0.1                                                            
│       tie_dropout: true                                                       
│       track_norms: true                                                       
│       encoder: null                                                           
│       decoder: null                                                           
│                                                                               
└── callbacks
    └── learning_rate_monitor:                                                  
          logging_interval: step                                                
        timer:                                                                  
          step: true                                                            
          inter_step: false                                                     
          epoch: true                                                           
          val: true                                                             
        params:                                                                 
          total: true                                                           
          trainable: true                                                       
          fixed: true                                                           
        model_checkpoint:                                                       
          monitor: val/accuracy                                                 
          mode: max                                                             
          save_top_k: 1                                                         
          save_last: true                                                       
          dirpath: checkpoints/                                                 
          filename: val/accuracy                                                
          auto_insert_metric_name: false                                        
          verbose: true                                                         
        early_stopping:                                                         
          monitor: val/acc                                                      
          mode: max                                                             
          patience: 20                                                          
          min_delta: 0                                                          
        rich_model_summary:                                                     
          max_depth: 1                                                          
        rich_progress_bar:                                                      
          refresh_rate: 1                                                       
          leave: true                                                           
                                                                                
[rank: 0] Global seed set to 2222
wandb: Currently logged in as: yuqinzhou. Use `wandb login --relogin` to force relogin
wandb: Tracking run with wandb version 0.15.3
wandb: Run data is saved locally in ./wandb/run-20230520_123416-0l9u7xzm
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run stellar-sea-1
wandb: ⭐️ View project at https://wandb.ai/yuqinzhou/TNLM
wandb: 🚀 View run at https://wandb.ai/yuqinzhou/TNLM/runs/0l9u7xzm
[2023-05-20 12:34:25,113][__main__][INFO] - Instantiating callback <pytorch_lightning.callbacks.LearningRateMonitor>
[2023-05-20 12:34:25,114][__main__][INFO] - Instantiating callback <src.callbacks.timer.Timer>
[2023-05-20 12:34:25,120][__main__][INFO] - Instantiating callback <src.callbacks.params.ParamsLog>
[2023-05-20 12:34:25,123][__main__][INFO] - Instantiating callback <pytorch_lightning.callbacks.ModelCheckpoint>
[2023-05-20 12:34:25,128][__main__][INFO] - Instantiating callback <pytorch_lightning.callbacks.EarlyStopping>
[2023-05-20 12:34:25,129][__main__][INFO] - Instantiating callback <pytorch_lightning.callbacks.RichModelSummary>
[2023-05-20 12:34:25,129][__main__][INFO] - Instantiating callback <pytorch_lightning.callbacks.RichProgressBar>
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
`Trainer(limit_train_batches=1.0)` was configured so 100% of the batches per epoch will be used..
`Trainer(limit_val_batches=1.0)` was configured so 100% of the batches will be used..
Files already downloaded and verified
[2023-05-20 12:34:26,714][src.models.sequence.kernels.ssm][WARNING] - CUDA extension for structured kernels (Cauchy and Vandermonde multiplication) not found. Install by going to extensions/kernels/ and running `python setup.py install`, for improved speed and memory efficiency. Note that the kernel changed for state-spaces 4.0 and must be recompiled.
[2023-05-20 12:34:26,715][src.models.sequence.kernels.ssm][WARNING] - Falling back on slow Cauchy and Vandermonde kernel. Install at least one of pykeops or the CUDA extension for better speed and memory efficiency.
[2023-05-20 12:34:26,751][src.models.sequence.kernels.ssm][INFO] - Constructing S4 (H, N, L) = (512, 32, None)
[2023-05-20 12:34:26,769][src.models.sequence.kernels.ssm][INFO] - Constructing S4 (H, N, L) = (512, 32, None)
[2023-05-20 12:34:26,786][src.models.sequence.kernels.ssm][INFO] - Constructing S4 (H, N, L) = (512, 32, None)
[2023-05-20 12:34:26,804][src.models.sequence.kernels.ssm][INFO] - Constructing S4 (H, N, L) = (512, 32, None)
[2023-05-20 12:34:26,820][src.models.sequence.kernels.ssm][INFO] - Constructing S4 (H, N, L) = (512, 32, None)
[2023-05-20 12:34:26,836][src.models.sequence.kernels.ssm][INFO] - Constructing S4 (H, N, L) = (512, 32, None)
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Files already downloaded and verified
Hyperparameter groups [{'weight_decay': 0.0, 'lr': 0.001}]
[2023-05-20 12:34:28,948][__main__][INFO] - Optimizer group 0 | 40 tensors | lr 0.01 | weight_decay 0.05
[2023-05-20 12:34:28,949][__main__][INFO] - Optimizer group 1 | 30 tensors | lr 0.001 | weight_decay 0.0
┏━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃   ┃ Name    ┃ Type            ┃ Params ┃
┡━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0 │ model   │ SequenceModel   │  3.6 M │
│ 1 │ encoder │ Linear          │  2.0 K │
│ 2 │ decoder │ SequenceDecoder │  5.1 K │
└───┴─────────┴─────────────────┴────────┘
Trainable params: 3.6 M                                                         
Non-trainable params: 0                                                         
Total params: 3.6 M                                                             
Total estimated model params size (MB): 14                                      
SLURM auto-requeueing enabled. Setting signal handlers.
[2023-05-20 12:34:28,977][__main__][INFO] - Loaded 'val' dataloader:         5000 examples |    100 steps
[2023-05-20 12:34:28,977][__main__][INFO] - Loaded 'test' dataloader:       10000 examples |    200 steps
[2023-05-20 12:34:30,251][src.models.sequence.kernels.ssm][INFO] - S4: Initializing kernel to length 1024
[2023-05-20 12:34:30,758][src.models.sequence.kernels.ssm][INFO] - S4: Initializing kernel to length 1024
[2023-05-20 12:34:30,801][src.models.sequence.kernels.ssm][INFO] - S4: Initializing kernel to length 1024
[2023-05-20 12:34:30,841][src.models.sequence.kernels.ssm][INFO] - S4: Initializing kernel to length 1024
[2023-05-20 12:34:30,882][src.models.sequence.kernels.ssm][INFO] - S4: Initializing kernel to length 1024
[2023-05-20 12:34:30,924][src.models.sequence.kernels.ssm][INFO] - S4: Initializing kernel to length 1024
[2023-05-20 12:34:31,768][__main__][INFO] - Loaded 'train' dataloader:      45000 examples |    900 steps
Epoch 0/199 ━━━━━━━━━━━━━━━ 1200/1200 0:11:30 •       4.97it/s loss: 1.25 v_num:
                                      0:00:00                  7xzm             
                                                               val/accuracy:    
                                                               0.586 val/loss:  
                                                               1.15             
                                                               test/accuracy:   
                                                               0.582 test/loss: 
                                                               1.148            
Error executing job with overrides: ['experiment=cifar/s4-cifar']
Traceback (most recent call last):
  File "/home/qvk729/Master_thesis/train.py", line 709, in main
    train(config)
  File "/home/qvk729/Master_thesis/train.py", line 693, in train
    trainer.fit(model)
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 608, in fit
    call._call_and_handle_interrupt(
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 38, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 650, in _fit_impl
    self._run(model, ckpt_path=self.ckpt_path)
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 1112, in _run
    results = self._run_stage()
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 1191, in _run_stage
    self._run_train()
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 1214, in _run_train
    self.fit_loop.run()
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/pytorch_lightning/loops/loop.py", line 200, in run
    self.on_advance_end()
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 295, in on_advance_end
    self.trainer._call_callback_hooks("on_train_epoch_end")
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 1394, in _call_callback_hooks
    fn(self, self.lightning_module, *args, **kwargs)
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/pytorch_lightning/callbacks/early_stopping.py", line 184, in on_train_epoch_end
    self._run_early_stopping_check(trainer)
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/pytorch_lightning/callbacks/early_stopping.py", line 195, in _run_early_stopping_check
    if trainer.fast_dev_run or not self._validate_condition_metric(  # disable early_stopping with fast_dev_run
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/pytorch_lightning/callbacks/early_stopping.py", line 150, in _validate_condition_metric
    raise RuntimeError(error_msg)
RuntimeError: Early stopping conditioned on metric `val/acc` which is not available. Pass in or modify your `EarlyStopping` callback to use any of the following: `trainer/loss`, `trainer/epoch`, `norm/0`, `norm/1`, `norm/2`, `norm/3`, `norm/4`, `norm/5`, `norm/6`, `val/accuracy`, `val/loss`, `test/accuracy`, `test/loss`, `train/accuracy`, `train/loss`

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
wandb: Waiting for W&B process to finish... (failed 1). Press Control-C to abort syncing.
wandb: 
wandb: Run history:
wandb:               epoch ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:              norm/0 ▇▇▇▆██▇▇█▆▇▅▆▅▆▆▄▄▄▅▃▄▃▃▃▃▃▃▂▃▂▂▁▂▂▂▂▂▁▁
wandb:              norm/1 ██████████████████▇█▇▇▇▆▆▆▅▅▅▄▄▄▃▃▃▃▂▂▁▁
wandb:              norm/2 ▆▆▆▆▆▆▆▆▇▇▇▇▇▇▇▇██▇█▇▇▇▇▇▆▆▆▆▅▅▅▄▅▄▅▃▃▁▁
wandb:              norm/3 ▄▄▄▄▄▄▅▄▅▅▅▆▅▅▅▆▇▇▆█▆▆▆▇▇▆▆▆▆▅▆▆▅▅▄▅▃▃▁▁
wandb:              norm/4 ▃▃▃▃▃▃▃▃▄▄▄▄▄▄▄▆▆▇▆█▆▆▆▇▇▅▇▇▇▆▇▇▅▆▅▇▅▃▁▂
wandb:              norm/5 ▁▁▁▁▁▁▁▁▂▂▂▃▂▂▂▄▅▅▄▇▅▄▄▆▅▄▆▆▆▅▆▆▅▆▅█▅▃▁▄
wandb:              norm/6 ████████▇▇▇▇▇▆▆▆▅▅▅▄▄▄▄▃▃▃▃▃▂▂▂▂▂▁▂▁▁▁▁▁
wandb:       test/accuracy ▁
wandb:           test/loss ▁
wandb:         timer/epoch ▁
wandb:          timer/step ▁▂▂▆▂▄▂▄▄▄▃▂▃▇▄▆▃▄▆▆▅▆▆▇▄▅▅▅▂▃▅▄▄▃▃█▄▅▃█
wandb:    timer/validation ▁█
wandb:       trainer/epoch ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb: trainer/global_step ▁▁▁▁▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇▇███
wandb:        trainer/loss █▇▆▆▅▆▆▃▄▅▆▄▄▄▅▅▄▄▃▃▅▄▃▃▃▃▃▂▄▂▂▁▃▂▄▂▃▂▁▂
wandb:      trainer/lr/pg1 ▁▁▁▁▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇▇███
wandb:      trainer/lr/pg2 ▁▁▁▁▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇▇███
wandb:        val/accuracy ▁
wandb:            val/loss ▁
wandb: 
wandb: Run summary:
wandb:               epoch 0
wandb:              norm/0 0.2591
wandb:              norm/1 0.77861
wandb:              norm/2 0.80755
wandb:              norm/3 0.87303
wandb:              norm/4 0.96449
wandb:              norm/5 1.09307
wandb:              norm/6 0.1988
wandb:       test/accuracy 0.5821
wandb:           test/loss 1.14789
wandb:         timer/epoch 690.15425
wandb:          timer/step 0.26361
wandb:    timer/validation 61.24877
wandb:       trainer/epoch 0.0
wandb: trainer/global_step 900
wandb:        trainer/loss 1.30918
wandb:      trainer/lr/pg1 0.00999
wandb:      trainer/lr/pg2 0.001
wandb:        val/accuracy 0.5858
wandb:            val/loss 1.14984
wandb: 
wandb: 🚀 View run stellar-sea-1 at: https://wandb.ai/yuqinzhou/TNLM/runs/0l9u7xzm
wandb: Synced 6 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20230520_123416-0l9u7xzm/logs
Exception in thread NetStatThr:
Traceback (most recent call last):
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/threading.py", line 953, in run
    self._target(*self._args, **self._kwargs)
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 260, in check_network_status
    self._loop_check_status(
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/wandb/sdk/wandb_run.py", line 216, in _loop_check_status
    local_handle = request()
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/wandb/sdk/interface/interface.py", line 795, in deliver_network_status
    return self._deliver_network_status(status)
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/wandb/sdk/interface/interface_shared.py", line 601, in _deliver_network_status
    return self._deliver_record(record)
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/wandb/sdk/interface/interface_shared.py", line 560, in _deliver_record
    handle = mailbox._deliver_record(record, interface=self)
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/wandb/sdk/lib/mailbox.py", line 455, in _deliver_record
    interface._publish(record)
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/wandb/sdk/interface/interface_sock.py", line 51, in _publish
    self._sock_client.send_record_publish(record)
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/wandb/sdk/lib/sock_client.py", line 221, in send_record_publish
    self.send_server_request(server_req)
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/wandb/sdk/lib/sock_client.py", line 155, in send_server_request
    self._send_message(msg)
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/wandb/sdk/lib/sock_client.py", line 152, in _send_message
    self._sendall_with_error_handle(header + data)
  File "/home/qvk729/miniconda3/envs/TNLM/lib/python3.10/site-packages/wandb/sdk/lib/sock_client.py", line 130, in _sendall_with_error_handle
    sent = self._sock.send(data)
BrokenPipeError: [Errno 32] Broken pipe
